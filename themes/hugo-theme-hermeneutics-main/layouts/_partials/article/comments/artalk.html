<link href="{{ printf "%s/npm/artalk@2.9.1/dist/Artalk.css" .Site.Params.cdn.jsd }}" rel="stylesheet" />
{{- partial "utils/loadcss.html" "css/article/comments/artalk.css" -}}

<div id="artalk" class="prose"></div>

<script src="{{ printf "%s/npm/artalk@2.9.1/dist/Artalk.js" .Site.Params.cdn.jsd }}" defer></script>

<script defer>
    function initArtalk() {
        window.artalk = Artalk.init({
            el: '#artalk',
            pageKey: '{{ printf "/%s" (trim .RelPermalink "/") }}',
            pageTitle: '{{ .Page.Title }}',
            server: '{{ .Site.Params.comments.artalk.server }}',
            site: '{{ .Site.Title }}',
            darkMode: currentTheme === 'dark',
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        if (currentTheme === null) getTheme();
        initArtalk();

        new MutationObserver(() => {
            if (window.artalk) window.artalk.setDarkMode(currentTheme === 'dark');
        }).observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['class']
        });
    });
</script>